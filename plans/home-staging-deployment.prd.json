{
  "name": "Deploy to home-staging.awsdev.treasury.gov",
  "description": "Deploy the Treasury Hugo site to home-staging.awsdev.treasury.gov using S3 + CloudFront with ACM certificate and Route53 DNS",
  "created": "2026-01-15",
  "ship_sprint_id": null,
  "feedbackLoops": {
    "validate": "cd terraform && terraform validate",
    "plan": "cd terraform && terraform plan -out=tfplan",
    "build": "hugo --minify"
  },
  "userStories": [
    {
      "id": "add-domain-variables",
      "title": "Add custom domain variables and data sources to Terraform",
      "description": "Add Terraform variables for custom domain name and environment flag, plus a data source to look up the awsdev.treasury.gov Route53 zone by name",
      "verification": [
        "terraform/variables.tf contains domain_name variable with default 'home-staging.awsdev.treasury.gov'",
        "terraform/variables.tf contains enable_custom_domain boolean variable defaulting to true",
        "terraform/main.tf contains data source for route53 zone lookup by name 'awsdev.treasury.gov'",
        "terraform validate succeeds"
      ],
      "priority": "high",
      "passes": true
    },
    {
      "id": "create-acm-certificate",
      "title": "Create ACM certificate with DNS validation",
      "description": "Create an ACM certificate in us-east-1 (required for CloudFront) for home-staging.awsdev.treasury.gov with DNS validation, and create the validation records in Route53",
      "verification": [
        "terraform/main.tf contains aws_acm_certificate resource with provider = aws.us_east_1",
        "terraform/main.tf contains aws_route53_record for certificate validation",
        "terraform/main.tf contains aws_acm_certificate_validation resource to wait for validation",
        "Certificate uses DNS validation_method",
        "terraform validate succeeds"
      ],
      "priority": "high",
      "passes": false
    },
    {
      "id": "update-cloudfront-domain",
      "title": "Update CloudFront distribution with custom domain and certificate",
      "description": "Modify the CloudFront distribution to add the custom domain as an alias and use the ACM certificate instead of the default certificate",
      "verification": [
        "CloudFront distribution has aliases = [var.domain_name] when enable_custom_domain is true",
        "viewer_certificate block uses acm_certificate_arn when enable_custom_domain is true",
        "ssl_support_method is set to 'sni-only'",
        "minimum_protocol_version is 'TLSv1.2_2021'",
        "terraform validate succeeds"
      ],
      "priority": "high",
      "passes": false
    },
    {
      "id": "create-dns-records",
      "title": "Create Route53 A and AAAA records for CloudFront",
      "description": "Create Route53 alias records (A and AAAA for IPv4 and IPv6) pointing home-staging.awsdev.treasury.gov to the CloudFront distribution",
      "verification": [
        "terraform/main.tf contains aws_route53_record for A record with alias to CloudFront",
        "terraform/main.tf contains aws_route53_record for AAAA record with alias to CloudFront",
        "Records use CloudFront hosted_zone_id (Z2FDTNDATAQYW2)",
        "terraform validate succeeds"
      ],
      "priority": "high",
      "passes": false
    },
    {
      "id": "update-outputs",
      "title": "Update Terraform outputs for custom domain",
      "description": "Update outputs.tf to include the custom domain URL and certificate ARN, and update the site_url output to use the custom domain when enabled",
      "verification": [
        "outputs.tf contains custom_domain output",
        "outputs.tf contains certificate_arn output",
        "site_url output shows https://home-staging.awsdev.treasury.gov when custom domain is enabled",
        "terraform validate succeeds"
      ],
      "priority": "medium",
      "passes": false
    },
    {
      "id": "apply-infrastructure",
      "title": "Apply Terraform infrastructure changes",
      "description": "Run terraform plan and terraform apply to provision the ACM certificate, wait for DNS validation, update CloudFront, and create DNS records",
      "verification": [
        "terraform plan shows expected changes (ACM cert, Route53 records, CloudFront update)",
        "terraform apply completes successfully",
        "ACM certificate status is ISSUED (not PENDING_VALIDATION)",
        "CloudFront distribution status is Deployed"
      ],
      "priority": "high",
      "passes": false
    },
    {
      "id": "deploy-hugo-content",
      "title": "Build and deploy Hugo site content to S3",
      "description": "Build the Hugo site with minification and sync the public/ directory to the S3 bucket, then invalidate CloudFront cache",
      "verification": [
        "hugo --minify builds successfully",
        "aws s3 sync uploads content to the bucket",
        "CloudFront invalidation is created",
        "https://home-staging.awsdev.treasury.gov loads successfully",
        "Site content is visible and styled correctly"
      ],
      "priority": "high",
      "passes": false
    }
  ],
  "postCompletion": {
    "securityReview": false,
    "codeQualityReview": false,
    "testsAdded": false,
    "seedDataChecked": false,
    "fixturesUpdated": false,
    "docsChecked": false,
    "learningsExtracted": false,
    "criticalFindings": []
  }
}
