# Progress Log
PRD: plans/home-staging-deployment.prd.json
Started: 2026-01-15

---

(Progress will be appended here as stories complete)

## Iteration 1 - Add custom domain variables and data sources to Terraform
- Completed: Added variables for domain_name, enable_custom_domain, route53_zone_name. Added Route53 zone data source.
- Files changed: terraform/variables.tf, terraform/main.tf
- Learnings: Used conditional count on data source for optional custom domain support
- Next: Create ACM certificate with DNS validation

## Iteration 2 - Create ACM certificate with DNS validation
- Completed: Added ACM certificate in us-east-1, Route53 validation records, and validation waiter
- Files changed: terraform/main.tf
- Learnings: Used for_each with conditional for DNS validation records to handle dynamic validation options
- Next: Update CloudFront distribution with custom domain and certificate

## Iteration 3 - Update CloudFront distribution with custom domain and certificate
- Completed: Added aliases and updated viewer_certificate to use ACM cert conditionally
- Files changed: terraform/main.tf
- Learnings: depends_on cannot be conditional, but implicit dependencies through resource references work
- Next: Create Route53 A and AAAA records for CloudFront

## Iteration 4 - Create Route53 A and AAAA records for CloudFront
- Completed: Added A and AAAA alias records pointing to CloudFront distribution
- Files changed: terraform/main.tf
- Learnings: CloudFront provides hosted_zone_id attribute that resolves to Z2FDTNDATAQYW2
- Next: Update Terraform outputs for custom domain

## Iteration 5 - Update Terraform outputs for custom domain
- Completed: Added custom_domain and certificate_arn outputs, updated site_url to use custom domain
- Files changed: terraform/outputs.tf
- Learnings: Conditional outputs work well for optional features
- Next: Apply Terraform infrastructure changes

## Iteration 6 - Apply Terraform infrastructure changes
- Completed: Applied all Terraform changes - ACM cert, Route53 records, CloudFront update
- Resources: 6 added, 1 changed, 0 destroyed
- Certificate ARN: arn:aws:acm:us-east-1:463735866612:certificate/c9091d12-19fb-408d-bc30-39754b3a100a
- Learnings: ACM validation was fast (~1 second after DNS record created), CloudFront update took ~3.5 minutes
- Next: Build and deploy Hugo site content to S3

## Iteration 7 - Build and deploy Hugo site content to S3
- Completed: Built 14,749 pages with hugo --minify, synced 1.2GB to S3, created CloudFront invalidation
- Site URL: https://home-staging.awsdev.treasury.gov
- Verification: HTTP 200, all security headers present (HSTS, CSP, X-Frame-Options, etc.)
- Learnings: S3 sync with --delete removes Terraform-managed objects; may need to adjust workflow
- DEPLOYMENT COMPLETE
