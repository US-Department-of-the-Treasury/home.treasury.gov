<!-- Treasury Header - Branding Section -->
<header id="header">
  <div class="header-branding-wrapper">
    <div class="header-inner">
      <!-- Logo/Branding -->
      <div class="header-branding">
        <a href="/" class="logo">
          <img src="{{ "images/treasury-seal.svg" | relURL }}" alt="" class="treasury-logo" role="presentation">
          <span class="logo-text">U.S. DEPARTMENT OF THE TREASURY</span>
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Main Navigation - Sticky -->
<nav class="main-nav" aria-label="Main navigation">
  <div class="nav-inner">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-expanded="false" aria-controls="nav-menu" aria-label="Menu">
      <span class="hamburger"></span>
    </button>
    
    <!-- Logo appears when scrolled -->
    <a href="/" class="nav-logo" aria-label="Home">
      <img src="{{ "images/treasury-seal.svg" | relURL }}" alt="Treasury Seal">
    </a>
    <ul class="nav-menu" id="nav-menu">
      {{ $navData := site.Data.navigation }}
      {{ $currentPath := $.Page.RelPermalink }}
      {{ range $navData.main_nav }}
      {{ $isActive := false }}
      {{ if .active_path }}
        {{ if hasPrefix $currentPath .active_path }}
          {{ $isActive = true }}
        {{ end }}
      {{ end }}
      <li class="nav-item {{ if .columns }}has-dropdown{{ end }}{{ if $isActive }} active{{ end }}">
        {{ if .columns }}
        {{ $menuId := .title | urlize | printf "menu-%s" }}
        <button class="nav-link" aria-expanded="false" aria-haspopup="true" aria-controls="{{ $menuId }}">
          {{ .title }}
        </button>
        <div class="mega-menu" id="{{ $menuId }}" role="region" aria-label="{{ .title }} submenu">
          <div class="mega-menu-inner">
            {{ range .columns }}
            <div class="mega-menu-column">
              <h3 class="mega-menu-heading">{{ .heading }}</h3>
              <ul class="mega-menu-links">
                {{/* Check if this column should show recent articles */}}
                {{ if eq .type "articles" }}
                  {{/* Map heading to section path */}}
                  {{ $sectionPath := "" }}
                  {{ if eq .heading "FEATURED STORIES" }}
                    {{ $sectionPath = "news/featured-stories" }}
                  {{ else if eq .heading "PRESS RELEASES" }}
                    {{ $sectionPath = "news/press-releases" }}
                  {{ else if eq .heading "REMARKS AND STATEMENTS" }}
                    {{ $sectionPath = "news/statements-remarks" }}
                  {{ end }}
                  
                  {{ if $sectionPath }}
                    {{ $section := site.GetPage $sectionPath }}
                    {{ if $section }}
                      {{ range first 4 $section.Pages.ByDate.Reverse }}
                      <li><a href="{{ .Permalink }}">{{ .Title | truncate 55 }}</a></li>
                      {{ end }}
                    {{ end }}
                  {{ end }}
                  
                  {{/* Always show View All link */}}
                  {{ range .links }}
                  {{ $url := .url }}
                  {{ if and (hasPrefix $url "/") (not (hasSuffix $url "/")) (not (strings.Contains $url ".")) }}
                    {{ $url = printf "%s/" $url }}
                  {{ end }}
                  <li class="view-all"><a href="{{ $url }}">{{ .title }} â†’</a></li>
                  {{ end }}
                {{ else }}
                  {{ range .links }}
                  {{/* Add trailing slash to internal URLs that don't have one */}}
                  {{ $url := .url }}
                  {{ if and (hasPrefix $url "/") (not (hasSuffix $url "/")) (not (strings.Contains $url ".")) }}
                    {{ $url = printf "%s/" $url }}
                  {{ end }}
                  <li><a href="{{ $url }}">{{ .title }}</a></li>
                  {{ end }}
                {{ end }}
              </ul>
            </div>
            {{ end }}
          </div>
        </div>
        {{ else }}
        <a href="{{ .url }}" class="nav-link">{{ .title }}</a>
        {{ end }}
      </li>
      {{ end }}
    </ul>
    
    <!-- Search Button -->
    <div class="nav-search">
      <button class="search-toggle" aria-expanded="false" aria-controls="search-dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <span>SEARCH</span>
      </button>
      
      <!-- Search Dropdown -->
      <div id="search-dropdown" class="search-dropdown" hidden>
        <form class="search-form" action="https://search.usa.gov/search" method="get">
          <input type="hidden" name="affiliate" value="treasury">
          <div class="search-input-group">
            <input type="text" name="query" placeholder="Enter keywords" class="search-input" aria-label="Search">
            <button type="submit" class="search-go">GO</button>
          </div>
        </form>
        
        <div class="search-categories">
          {{ range $navData.search.categories }}
          <div class="search-category">
            <h4>{{ .heading }}</h4>
            <ul>
              {{ range .links }}
              {{ $url := .url }}
              {{ if and (hasPrefix $url "/") (not (hasSuffix $url "/")) (not (strings.Contains $url ".")) }}
                {{ $url = printf "%s/" $url }}
              {{ end }}
              <li><a href="{{ $url }}">{{ .title }}</a></li>
              {{ end }}
            </ul>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</nav>
