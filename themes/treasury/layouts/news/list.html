{{ define "main" }}
{{/* Redirect /news/ to /news/press-releases/ */}}
{{ if eq .RelPermalink "/news/" }}
<script>window.location.replace("/news/press-releases/");</script>
<meta http-equiv="refresh" content="0; url=/news/press-releases/">
{{ else }}

{{/* Handle ?page=X query param - redirect to Hugo's /page/X+1/ */}}
<script>
(function() {
  var params = new URLSearchParams(window.location.search);
  var page = params.get('page');
  if (page !== null) {
    var pageNum = parseInt(page, 10) + 1;
    var totalPages = {{ .Paginator.TotalPages }};
    if (pageNum > 1 && pageNum <= totalPages) {
      window.location.replace(window.location.pathname + 'page/' + pageNum + '/');
    } else if (pageNum > totalPages) {
      window.location.replace('https://home.treasury.gov' + window.location.pathname + '?page=' + page);
    }
  }
})();
</script>

<div class="breadcrumbs">
  <div class="container">
    <nav aria-label="Breadcrumb">
      <ol class="breadcrumbs-list">
        <li><a href="https://home.treasury.gov/">HOME</a></li>
        <li><a href="/news/">NEWS</a></li>
        <li><span aria-current="page">{{ .Title | upper }}</span></li>
      </ol>
    </nav>
  </div>
</div>

<div class="news-page-section">
  <div class="container">
    <div class="news-three-col">
      {{/* Left Sidebar */}}
      {{ partial "news-sidebar.html" . }}
      
      {{/* Main Content */}}
      <div class="news-main-content" role="region" aria-labelledby="page-title">
        <header class="news-page-header">
          <h1 class="page-title">{{ .Title }}</h1>
          <div class="title-underline"></div>
        </header>
        
        {{ if .Content }}
        <div class="news-intro">
          {{ .Content }}
        </div>
        {{ end }}
        
        <div class="news-article-list">
          {{ $paginator := .Paginate .Pages 10 }}
          {{ range $paginator.Pages }}
          <article class="news-article-item">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
            <h2><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
          </article>
          {{ end }}
        </div>
        
        {{/* Pagination - Treasury.gov style with sliding window */}}
        {{ if gt $paginator.TotalPages 1 }}
        <nav class="pagination" aria-label="Pagination">
          {{ $currentPage := $paginator.PageNumber }}
          {{ $totalPages := $paginator.TotalPages }}
          
          {{/* Previous arrow */}}
          {{ if $paginator.HasPrev }}
          <a href="{{ $paginator.Prev.URL }}" class="page-arrow prev" aria-label="Previous page">←</a>
          {{ end }}
          
          {{/* Calculate which pages to show - sliding window around current page */}}
          {{ $startPage := 1 }}
          {{ $endPage := 3 }}
          
          {{/* If current page > 2, center the window around current page */}}
          {{ if gt $currentPage 2 }}
            {{ $startPage = sub $currentPage 1 }}
            {{ $endPage = add $currentPage 1 }}
          {{ end }}
          
          {{/* Don't exceed total pages */}}
          {{ if gt $endPage $totalPages }}
            {{ $endPage = $totalPages }}
            {{ $startPage = sub $endPage 2 }}
            {{ if lt $startPage 1 }}
              {{ $startPage = 1 }}
            {{ end }}
          {{ end }}
          
          {{/* Leading ellipsis if not starting at 1 */}}
          {{ if gt $startPage 1 }}
          <span class="page-ellipsis" aria-hidden="true">...</span>
          {{ end }}
          
          {{/* Page numbers */}}
          {{ range $paginator.Pagers }}
            {{ $pageNum := .PageNumber }}
            {{ if and (ge $pageNum $startPage) (le $pageNum $endPage) }}
              {{ if eq $pageNum $currentPage }}
              <span class="page-number current" aria-current="page">{{ $pageNum }}</span>
              {{ else }}
              <a href="{{ .URL }}" class="page-number">{{ $pageNum }}</a>
              {{ end }}
            {{ end }}
          {{ end }}
          
          {{/* Trailing ellipsis if not ending at last page */}}
          {{ if lt $endPage $totalPages }}
          <span class="page-ellipsis" aria-hidden="true">...</span>
          {{ end }}
          
          {{/* Next arrow */}}
          {{ if $paginator.HasNext }}
          <a href="{{ $paginator.Next.URL }}" class="page-arrow next" aria-label="Next page">→</a>
          {{ end }}
        </nav>
        {{ end }}
      </div>
      
      {{/* Right Sidebar - Keyword Search */}}
      {{ partial "news-search-sidebar.html" . }}
    </div>
  </div>
</div>
{{ end }}
{{ end }}
