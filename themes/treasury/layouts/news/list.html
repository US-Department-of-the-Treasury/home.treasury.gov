{{ define "main" }}
{{/* Redirect /news/ to /news/press-releases/ */}}
{{ if eq .RelPermalink "/news/" }}
<script>window.location.replace("/news/press-releases/");</script>
<meta http-equiv="refresh" content="0; url=/news/press-releases/">
{{ else }}
<div class="breadcrumbs">
  <div class="container">
    <nav aria-label="Breadcrumb">
      <ol class="breadcrumbs-list">
        <li><a href="https://home.treasury.gov/">HOME</a></li>
        <li><a href="/news/">NEWS</a></li>
        <li><span aria-current="page">{{ .Title | upper }}</span></li>
      </ol>
    </nav>
  </div>
</div>

<div class="news-page-section">
  <div class="container">
    <div class="news-three-col">
      {{/* Left Sidebar */}}
      {{ partial "news-sidebar.html" . }}
      
      {{/* Main Content */}}
      <main class="news-main-content">
        <header class="news-page-header">
          <h1 class="page-title">{{ .Title }}</h1>
          <div class="title-underline"></div>
        </header>
        
        {{/* Mobile Filter Toggle */}}
        <button class="mobile-filter-toggle" id="mobile-filter-toggle" aria-expanded="false" aria-controls="mobile-search-panel">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          Filter & Search
        </button>
        
        {{ if .Content }}
        <div class="news-intro">
          {{ .Content }}
        </div>
        {{ end }}
        
        {{/* Results Count */}}
        {{ $paginator := .Paginate .Pages 10 }}
        <div class="results-summary">
          <span class="results-count-display">Showing {{ len $paginator.Pages }} of {{ len .Pages }} {{ .Title }}</span>
        </div>
        
        <div class="news-article-list">
          {{ range $paginator.Pages }}
          <article class="news-article-item">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
            {{/* Display category tags */}}
            {{ if .Params.category }}
            <span class="article-category"><a href="/news/{{ .Params.category | urlize }}/">{{ .Params.category }}</a></span>
            {{ else }}
              {{ with .Params.categories }}
                {{ with index . 0 }}
                <span class="article-category"><a href="/news/{{ . | urlize }}/">{{ . }}</a></span>
                {{ end }}
              {{ end }}
            {{ end }}
            <h2><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
          </article>
          {{ end }}
        </div>
        
        {{/* Pagination with page count and jump-to-page */}}
        {{ if gt $paginator.TotalPages 1 }}
        <nav class="pagination-wrapper" aria-label="Pagination">
          {{ $currentPage := $paginator.PageNumber }}
          {{ $totalPages := $paginator.TotalPages }}
          {{ $baseURL := .CurrentSection.RelPermalink }}
          
          <div class="pagination">
            {{/* First Button */}}
            {{ if gt $currentPage 1 }}
            <a href="{{ $baseURL }}" class="page-nav first" aria-label="First page">« First</a>
            {{ else }}
            <span class="page-nav first disabled" aria-disabled="true">« First</span>
            {{ end }}
            
            {{/* Previous Arrow */}}
            {{ if $paginator.HasPrev }}
            <a href="{{ $paginator.Prev.URL }}" class="page-arrow prev" aria-label="Previous page">←</a>
            {{ else }}
            <span class="page-arrow prev disabled" aria-disabled="true">←</span>
            {{ end }}
            
            {{/* First page number */}}
            {{ if eq $currentPage 1 }}
            <span class="page-number current" aria-current="page">1</span>
            {{ else }}
            <a href="{{ $baseURL }}" class="page-number">1</a>
            {{ end }}
            
            {{/* Left ellipsis */}}
            {{ if gt $currentPage 4 }}
            <span class="page-ellipsis">...</span>
            {{ end }}
            
            {{/* Pages around current - show 2 on each side */}}
            {{ range $paginator.Pagers }}
              {{ $pageNum := .PageNumber }}
              {{ if and (gt $pageNum 1) (lt $pageNum $totalPages) }}
                {{ if and (ge $pageNum (sub $currentPage 2)) (le $pageNum (add $currentPage 2)) }}
                  {{ if eq $pageNum $currentPage }}
                  <span class="page-number current" aria-current="page">{{ $pageNum }}</span>
                  {{ else }}
                  <a href="{{ .URL }}" class="page-number">{{ $pageNum }}</a>
                  {{ end }}
                {{ end }}
              {{ end }}
            {{ end }}
            
            {{/* Right ellipsis */}}
            {{ if lt $currentPage (sub $totalPages 3) }}
            <span class="page-ellipsis">...</span>
            {{ end }}
            
            {{/* Last page number */}}
            {{ if gt $totalPages 1 }}
              {{ if eq $currentPage $totalPages }}
              <span class="page-number current" aria-current="page">{{ $totalPages }}</span>
              {{ else }}
              <a href="{{ $baseURL }}page/{{ $totalPages }}/" class="page-number">{{ $totalPages }}</a>
              {{ end }}
            {{ end }}
            
            {{/* Next Arrow */}}
            {{ if $paginator.HasNext }}
            <a href="{{ $paginator.Next.URL }}" class="page-arrow next" aria-label="Next page">→</a>
            {{ else }}
            <span class="page-arrow next disabled" aria-disabled="true">→</span>
            {{ end }}
            
            {{/* Last Button */}}
            {{ if lt $currentPage $totalPages }}
            <a href="{{ $baseURL }}page/{{ $totalPages }}/" class="page-nav last" aria-label="Last page">Last »</a>
            {{ else }}
            <span class="page-nav last disabled" aria-disabled="true">Last »</span>
            {{ end }}
          </div>
          
          {{/* Page info and jump-to */}}
          <div class="pagination-info">
            <span class="page-count">Page {{ $currentPage }} of {{ $totalPages }}</span>
            <form class="page-jump" onsubmit="return jumpToPage(this, '{{ $baseURL }}', {{ $totalPages }})">
              <label for="page-jump-input" class="visually-hidden">Go to page</label>
              <input type="number" 
                     id="page-jump-input" 
                     class="page-jump-input" 
                     min="1" 
                     max="{{ $totalPages }}" 
                     placeholder="Page #"
                     aria-label="Page number">
              <button type="submit" class="page-jump-btn">Go</button>
            </form>
          </div>
        </nav>
        
        <script>
        function jumpToPage(form, baseURL, totalPages) {
          var input = form.querySelector('input');
          var page = parseInt(input.value, 10);
          if (page >= 1 && page <= totalPages) {
            if (page === 1) {
              window.location.href = baseURL;
            } else {
              window.location.href = baseURL + 'page/' + page + '/';
            }
          } else {
            alert('Please enter a page number between 1 and ' + totalPages);
          }
          return false;
        }
        </script>
        {{ end }}
      </main>
      
      {{/* Right Sidebar - Keyword Search */}}
      {{ partial "news-search-sidebar.html" . }}
    </div>
  </div>
</div>
{{ end }}
{{ end }}
