{{ define "main" }}
{{/* Redirect /news/ to /news/press-releases/ */}}
{{ if eq .RelPermalink "/news/" }}
{{/* Load external redirect script for CSP compliance */}}
{{ $redirectJS := resources.Get "js/news-redirect.js" | minify | fingerprint }}
<script src="{{ $redirectJS.RelPermalink }}"></script>
<meta http-equiv="refresh" content="0; url=/news/press-releases/">
{{ else }}
<div class="breadcrumbs">
  <div class="container">
    <nav aria-label="Breadcrumb">
      <ol class="breadcrumbs-list">
        <li><a href="https://home.treasury.gov/">HOME</a></li>
        <li><a href="/news/">NEWS</a></li>
        <li><span aria-current="page">{{ .Title | upper }}</span></li>
      </ol>
    </nav>
  </div>
</div>

<div class="news-page-section">
  <div class="container">
    <div class="news-two-col">
      {{/* Left Sidebar */}}
      {{ partial "news-sidebar.html" . }}

      {{/* Main Content */}}
      <main class="news-main-content news-main-full">
        <header class="news-page-header">
          <h1 class="page-title">{{ .Title }}</h1>
          <div class="title-underline"></div>
        </header>

        {{/* Inline Filters */}}
        {{ partial "news-inline-filters.html" . }}

        {{ if .Content }}
        <div class="news-intro">
          {{ .Content }}
        </div>
        {{ end }}

        {{/* Results Count */}}
        {{ $paginator := .Paginate .Pages 10 }}

        {{/* Paginated Content (wrapped for JS toggle) */}}
        <div id="paginated-content">
          <div class="results-summary">
            <span class="results-count-display">Showing {{ len $paginator.Pages }} of {{ len .Pages }} {{ .Title }}</span>
          </div>

          <div class="news-article-list">
            {{ range $paginator.Pages }}
            <article class="news-article-item">
              <div class="article-meta">
                {{/* Date and time display */}}
                <time datetime="{{ .Date.Format "2006-01-02T15:04:05-05:00" }}">
                  {{ .Date.Format "January 2, 2006" }} at {{ .Date.Format "3:04 PM" }} EST
                </time>
                {{/* Category from section path */}}
                {{ $section := .CurrentSection.Title }}
                {{ $sectionPath := path.Base .CurrentSection.RelPermalink }}
                {{ if and $section (ne $section "News") }}
                <span class="article-category-divider">|</span>
                <span class="article-category"><a href="/news/{{ $sectionPath }}/">{{ $section }}</a></span>
                {{ end }}
              </div>
              <h2><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
            </article>
            {{ end }}
          </div>

          {{/* Pagination with page count and jump-to-page */}}
          {{ if gt $paginator.TotalPages 1 }}
          <nav class="pagination-wrapper" aria-label="Pagination">
            {{ $currentPage := $paginator.PageNumber }}
            {{ $totalPages := $paginator.TotalPages }}
            {{ $baseURL := .CurrentSection.RelPermalink }}

            <div class="pagination">
              {{/* First Button */}}
              {{ if gt $currentPage 1 }}
              <a href="{{ $baseURL }}" class="page-nav first" aria-label="First page">« First</a>
              {{ else }}
              <span class="page-nav first disabled" aria-disabled="true">« First</span>
              {{ end }}

              {{/* Show 5 page numbers centered around current */}}
              {{ $startPage := 1 }}
              {{ $endPage := $totalPages }}

              {{/* Calculate window of 5 pages */}}
              {{ if gt $totalPages 5 }}
                {{ $startPage = sub $currentPage 2 }}
                {{ if lt $startPage 1 }}
                  {{ $startPage = 1 }}
                {{ end }}
                {{ $endPage = add $startPage 4 }}
                {{ if gt $endPage $totalPages }}
                  {{ $endPage = $totalPages }}
                  {{ $startPage = sub $endPage 4 }}
                {{ end }}
              {{ end }}

              {{/* Left ellipsis */}}
              {{ if gt $startPage 1 }}
              <span class="page-ellipsis">...</span>
              {{ end }}

              {{/* Page numbers */}}
              {{ range $paginator.Pagers }}
                {{ $pageNum := .PageNumber }}
                {{ if and (ge $pageNum $startPage) (le $pageNum $endPage) }}
                  {{ if eq $pageNum $currentPage }}
                  <span class="page-number current" aria-current="page">{{ $pageNum }}</span>
                  {{ else }}
                  <a href="{{ .URL }}" class="page-number">{{ $pageNum }}</a>
                  {{ end }}
                {{ end }}
              {{ end }}

              {{/* Right ellipsis */}}
              {{ if lt $endPage $totalPages }}
              <span class="page-ellipsis">...</span>
              {{ end }}

              {{/* Last Button */}}
              {{ if lt $currentPage $totalPages }}
              <a href="{{ $baseURL }}page/{{ $totalPages }}/" class="page-nav last" aria-label="Last page">Last »</a>
              {{ else }}
              <span class="page-nav last disabled" aria-disabled="true">Last »</span>
              {{ end }}
            </div>

            {{/* Page info and jump-to - uses data attributes for CSP compliance */}}
            <div class="pagination-info">
              <span class="page-count">Page {{ $currentPage }} of {{ $totalPages }}</span>
              <form class="page-jump" data-base-url="{{ $baseURL }}" data-total-pages="{{ $totalPages }}">
                <label for="page-jump-input" class="visually-hidden">Go to page</label>
                <input type="number"
                       id="page-jump-input"
                       class="page-jump-input"
                       min="1"
                       max="{{ $totalPages }}"
                       placeholder="Page #"
                       aria-label="Page number">
                <button type="submit" class="page-jump-btn">Go</button>
              </form>
            </div>
          </nav>

          {{/* Load pagination script for CSP compliance */}}
          {{ $paginationJS := resources.Get "js/pagination.js" | minify | fingerprint }}
          <script src="{{ $paginationJS.RelPermalink }}"></script>
          {{ end }}
        </div>
      </main>
    </div>
  </div>
</div>
{{ end }}
{{ end }}
